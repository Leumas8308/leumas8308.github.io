<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Pokémon Generator</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #FFFFFF;
  color: #000000;
  text-align: center;
  padding: 20px;
  margin: 0;
}
header {
  background: #FF0000;
  color: #FFFFFF;
  padding: 10px 0;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 20px;
}
.container {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.box {
  background: #F0F0F0;
  padding: 15px;
  border-radius: 12px;
  min-width: 150px;
}
button {
  margin-top: 20px;
  padding: 10px 20px;
  border: 2px solid #000;
  border-radius: 8px;
  background: #FFFFFF;
  color: #000000;
  font-size: 16px;
  cursor: pointer;
}
button:hover {
  background: #FF0000;
  color: #FFFFFF;
}
select {
  margin-top: 10px;
  padding: 5px;
  border-radius: 6px;
  border: 1px solid #000;
  font-size: 14px;
}
#result {
  margin-top: 30px;
}
#result img {
  image-rendering: pixelated;
  width: 96px;
  height: auto;
}
</style>
</head>
<body>

<header>Random Pokémon Generator</header>

<div class="container">
  <div class="box">
    <h3>Game Generation</h3>
    <select id="gameGen">
      <option value="">Select Game Gen</option>
      <option value="3">Gen 3</option>
      <option value="4">Gen 4</option>
      <option value="5">Gen 5</option>
      <option value="6">Gen 6</option>
      <option value="7">Gen 7</option>
      <option value="8">Gen 8</option>
      <option value="9">Gen 9</option>
    </select>
  </div>

  <div class="box">
    <h3>Categories</h3>
    <label><input type="checkbox" value="regular"> Regular</label><br>
    <label><input type="checkbox" value="pseudo"> Pseudo-Legendary</label><br>
    <label><input type="checkbox" value="mythical"> Mythical</label><br>
    <label><input type="checkbox" value="legendary"> Legendary</label>
  </div>
</div>

<button onclick="generatePokemon()">Generate</button>
<div id="result"></div>

<script>
const natures = [
  "Adamant","Bashful","Bold","Brave","Calm","Careful",
  "Docile","Gentle","Hardy","Hasty","Impish","Jolly",
  "Lax","Lonely","Mild","Modest","Naive","Quiet",
  "Quirky","Rash","Relaxed","Sassy","Serious","Timid"
];

const pseudoLegendaries = [149,248,373,376,445,635,706,784,887,1000];
const mythicals = [151,251,385,386,489,490,491,492,493,494,647,648,649,719,720,721,801,802,807,808,809,893,1015,1016,1017,1024];
const legendaries = [
  144,145,146,150,243,244,245,249,250,377,378,379,380,381,
  382,383,384,483,484,485,486,487,488,638,639,640,641,642,643,644,645,646,
  716,717,718,785,786,787,788,789,790,791,792,800,803,804,805,806,
  888,889,890,894,895,896,897,898,1001,1002,1003,1004,1007,1008,1009,1010,1018,1019,1020,1021
];

let cachedAbilities = null;

function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function getSpriteUrl(name) {
  return `https://play.pokemonshowdown.com/sprites/ani/${name.toLowerCase().replace(/[\s.'"]/g,'')}.gif`;
}

async function loadAbilities() {
  if(cachedAbilities) return cachedAbilities;
  const res = await fetch("abilities.txt");
  const text = await res.text();
  cachedAbilities = text.split("\n")
    .map(line => line.trim())
    .filter(line => line.length > 0)
    .map(line => {
      const [name, gen] = line.split(",");
      return { name: name.trim(), gen: parseInt(gen.trim()) };
    });
  return cachedAbilities;
}

async function fetchAbilities(maxGen) {
  const abilities = await loadAbilities();
  return abilities.filter(a => a.gen >= 3 && a.gen <= maxGen).map(a => a.name);
}

async function generatePokemon() {
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  const gameGen = parseInt(document.getElementById("gameGen").value);
  if(!gameGen) {
    alert("Select a game generation!");
    return;
  }

  const categoryChecks = [...document.querySelectorAll('.box input[type="checkbox"][value]')]
    .filter(cb => cb.checked && isNaN(cb.value))
    .map(cb => cb.value);

  if (categoryChecks.length === 0) {
    alert("Select at least one category!");
    return;
  }

  let abilities = await fetchAbilities(gameGen);
  if(abilities.length === 0) {
    alert("No abilities found for this game generation!");
    return;
  }

  let pool = [];

  for(let gen = 1; gen <= gameGen; gen++) {
    try {
      const res = await fetch(`https://pokeapi.co/api/v2/generation/${gen}`);
      const data = await res.json();
      data.pokemon_species.forEach(p => {
        const dexNum = parseInt(p.url.split('/').slice(-2,-1)[0]);
        if(
          (categoryChecks.includes("regular") && !pseudoLegendaries.includes(dexNum) && !mythicals.includes(dexNum) && !legendaries.includes(dexNum)) ||
          (categoryChecks.includes("pseudo") && pseudoLegendaries.includes(dexNum)) ||
          (categoryChecks.includes("mythical") && mythicals.includes(dexNum)) ||
          (categoryChecks.includes("legendary") && legendaries.includes(dexNum))
        ) {
          pool.push(p.name);
        }
      });
    } catch(e) { console.error("Error fetching gen "+gen,e); }
  }

  if(pool.length === 0) {
    alert("No Pokémon match that filter!");
    return;
  }

  const randomPokemon = pool[Math.floor(Math.random() * pool.length)];
  const ability = abilities[Math.floor(Math.random() * abilities.length)];
  const nature = natures[Math.floor(Math.random() * natures.length)];

  resultDiv.innerHTML = `
    <h2>${capitalize(randomPokemon)}</h2>
    <img src="${getSpriteUrl(randomPokemon)}" alt="${randomPokemon}">
    <p><b>Ability:</b> ${ability}</p>
    <p><b>Nature:</b> ${nature}</p>
  `;
}
</script>
</body>
</html>
